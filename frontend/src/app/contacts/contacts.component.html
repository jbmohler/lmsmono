<div class="h-full flex">
  <!-- Left Panel: Contact List -->
  <div class="w-80 border-r border-gray-200 flex flex-col bg-white">
    <!-- Header -->
    <div class="p-4 border-b border-gray-200 flex flex-col gap-3">
      <div class="flex items-center justify-between">
        <h1 class="text-lg font-semibold text-gray-900">Contacts</h1>
        <button
          (click)="createNewContact()"
          class="p-1.5 text-blue-600 hover:bg-blue-50 rounded-md"
          title="New Contact (Ctrl+Shift+N)"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </button>
      </div>
      <input
        #searchInput
        type="text"
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        placeholder="Search contacts..."
        class="w-full"
      />
    </div>

    <!-- Error Banner -->
    @if (error()) {
      <div class="px-4 py-2 bg-red-50 border-b border-red-200 text-red-700 text-sm">
        {{ error() }}
      </div>
    }

    <!-- Contact List -->
    <div class="flex-1 overflow-y-auto">
      @if (loading() && contacts().length === 0) {
        <div class="p-4 text-center text-gray-500 text-sm">
          Loading contacts...
        </div>
      } @else {
        @for (contact of filteredContacts(); track trackById($index, contact)) {
          <div
            (click)="selectContact(contact)"
            class="px-4 py-3 border-b border-gray-100 cursor-pointer hover:bg-gray-50"
            [class.bg-blue-50]="selectedContactId() === contact.id"
            [class.border-l-2]="selectedContactId() === contact.id"
            [class.border-l-blue-500]="selectedContactId() === contact.id"
          >
            <div class="font-medium text-gray-900 text-sm">{{ getDisplayName(contact) }}</div>
            @if (getSubtitle(contact)) {
              <div class="text-xs text-gray-500 mt-0.5">{{ getSubtitle(contact) }}</div>
            }
          </div>
        } @empty {
          <div class="p-4 text-center text-gray-500 text-sm">
            @if (searchQuery()) {
              No contacts match "{{ searchQuery() }}"
            } @else {
              No contacts yet
            }
          </div>
        }
      }
    </div>
  </div>

  <!-- Right Panel: Contact Detail -->
  <div class="flex-1 bg-gray-50 overflow-hidden">
    @if (selectedContact(); as contact) {
      <app-contact-detail
        [contact]="contact"
        (contactSaved)="onContactSaved($event)"
        (bitUpdated)="onBitUpdated($event)"
      />
    } @else if (selectedContactId() && loading()) {
      <!-- Loading state while fetching contact details -->
      <div class="h-full flex items-center justify-center text-gray-400">
        <div class="text-center flex flex-col items-center gap-4">
          <svg class="w-8 h-8 animate-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p class="text-sm">Loading contact...</p>
        </div>
      </div>
    } @else {
      <div class="h-full flex items-center justify-center text-gray-400">
        <div class="text-center flex flex-col items-center gap-4">
          <svg class="w-16 h-16 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <div class="flex flex-col gap-1">
            <p class="text-sm">Select a contact to view details</p>
            <p class="text-xs">or press Ctrl+Shift+N to create one</p>
          </div>
        </div>
      </div>
    }
  </div>
</div>
