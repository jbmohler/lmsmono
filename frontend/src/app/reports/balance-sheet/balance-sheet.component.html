<div class="page-container">
  <div class="page-header">
    <div class="flex items-center justify-between w-full">
      <div class="flex items-center gap-4">
        <a
          routerLink="/reports"
          class="inline-flex items-center gap-1 text-sm text-gray-500 hover:text-gray-900"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Reports
        </a>
        <h1 class="text-xl font-semibold text-gray-900">Current Balance Accounts</h1>
      </div>
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2 input-compact">
          <label class="label-compact" for="report-date">As of:</label>
          <input
            id="report-date"
            type="date"
            [value]="reportDate()"
            (change)="onDateChange($event)"
          />
        </div>
        <button class="btn btn-primary" (click)="generate()">Generate</button>
      </div>
    </div>
  </div>

  <div class="page-content">
    <div class="flex h-full gap-4 md:gap-6">
      <div class="flex-1 overflow-y-auto">
        <div class="max-w-3xl flex flex-col gap-4">
          @for (group of groups(); track group.atype_id) {
            <div class="card">
              <div class="px-4 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between">
                <h2 class="text-sm font-semibold text-gray-700 uppercase tracking-wide">{{ group.atype_name }}</h2>
                <span class="text-sm font-semibold text-gray-900">{{ group.subtotal | currency }}</span>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Account</th>
                    <th>Journal</th>
                    <th class="text-right">Balance</th>
                  </tr>
                </thead>
                <tbody>
                  @for (acct of group.accounts; track acct.id) {
                    <tr
                      class="row-clickable"
                      [class.bg-blue-50]="selectedAccountId() === acct.id"
                      (click)="selectAccount(acct.id)"
                    >
                      <td>
                        <span class="cell-primary">{{ acct.acc_name }}</span>
                        @if (acct.description) {
                          <span class="text-xs text-gray-400 ml-2">{{ acct.description }}</span>
                        }
                      </td>
                      <td class="text-sm text-gray-500">{{ acct.journal.name }}</td>
                      <td class="text-right tabular-nums">{{ acct.balance | currency }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          }

          @if (groups().length > 0) {
            <div class="card px-4 py-3 flex items-center justify-between bg-gray-50">
              <div class="flex gap-8">
                <div class="flex gap-2">
                  <span class="text-sm font-medium text-gray-600">Total Assets:</span>
                  <span class="text-sm font-semibold text-gray-900 tabular-nums">{{ totalAssets() | currency }}</span>
                </div>
                <div class="flex gap-2">
                  <span class="text-sm font-medium text-gray-600">Total Liabilities + Equity:</span>
                  <span class="text-sm font-semibold text-gray-900 tabular-nums">{{ totalLiabilitiesEquity() | currency }}</span>
                </div>
              </div>
              @if (totalAssets() !== totalLiabilitiesEquity()) {
                <span class="text-xs font-medium text-red-600">Out of balance</span>
              }
            </div>
          }

          @if (groups().length === 0) {
            <div class="card p-12 text-center text-gray-500 flex flex-col gap-1">
              <p class="text-sm">No balance sheet data for this date.</p>
              <p class="text-xs text-gray-400">Select a date and click Generate to view the report.</p>
            </div>
          }
        </div>
      </div>

      @if (selectedAccountId(); as acctId) {
        <div class="w-[28rem] flex-shrink-0 overflow-y-auto rounded-lg border border-gray-200 bg-white">
          <app-account-sidebar
            [accountId]="acctId"
            (sidebarClose)="closeSidebar()"
            (transactionOpen)="openTransaction($event)"
          />
        </div>
      }
    </div>
  </div>
</div>

@if (showEntryDialog()) {
  <app-transaction-entry
    [transactionId]="editTransactionId()"
    (dialogClose)="closeEntryDialog()"
    (dialogSave)="closeEntryDialog()"
  />
}
